(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){module.exports={highlights:[278,529,1218,1226,1244,1348,1355,1380,8023,1629,1721,3183,3520,60728,113926,114602,108860,109118,115836,116725,1270,90742,1411,1748,4324,5788],G200:[5788,116725,108860,60728,4324,1380,4379,117153,118304,7505,22412,114429,376,4829],G223:[5788,116725,108860,60728,4324,1380,4379,117153,118304,7505,22412,114429,376,4829],G230:[3520,3183,12111,3778,4866,1312,111893,111879,97,111088,115514,1358,1854,60728,4324,1380,4379,117153,118304,7505,22412,114429,376,4829],G258:[3520,3183,12111,3778,4866,1312,111893,111879,97,111088,115514,1358,1854,114833,115320,1937,111099,108767,45269,114602,678,112568],G260:[3183,12111,3778,4866,1312,111893,111879,97,111088,115514,1358,1854,114833,115320,1937,111099,108767,45269,114602,678,112568],G310:[1978,1629,8023,1727,91467,31247,113926,566,1748,4418,537,529,1348,12092,1218,10436,109118,278,1226],G321:[1978,1629,8023,1727,91467,31247,113926,566,1748,4418,537,529,1348,1704,1226],G350:[12092,1218,10436,109118,278,1226,566,1748,4418,537,529,1348,115352,114514,116116,109112,105014],G363:[12092,1218,10436,109118,278,115352,114514,116116,109112,105014,2606,1721,115836,107241,109328,1355,1244,1270,90742,1411,108443,2210,109122],G375:[95937,116294,98653,116191,115352,114514,116116,109112,105014,2606,1721,115836,107241,109328,1355,1244,1270,90742,1411,108443,2210,109122],G379:[95937,116294,98653,116191,115352,114514,116116,109112,105014,12092,1218,10436,1270,90742,1411,1637,113568,43877,108443,2210,109122],G236:["45269","4866","1312","108767","111099","97","111879","1854","12111","1937","3778","115514","115320","1358","111088","114833","111893","stories/377","stories/256","stories/352","stories/369","stories/371","stories/246","stories/249","stories/373"],G250:["45269","4866","1312","108767","111099","97","111879","1854","12111","1937","3778","115514","115320","1358","111088","114833","111893","stories/377","stories/256","stories/352","stories/369","stories/371","stories/246","stories/249","stories/373"],G254:["45269","4866","1312","108767","111099","97","111879","1854","12111","1937","3778","115514","115320","1358","111088","114833","111893","stories/377","stories/256","stories/352","stories/369","stories/371","stories/246","stories/249","stories/373"]}},{}],2:[function(require,module,exports){app.service("miaMediaMetaAdapter",function($http,$sce,envConfig){var _this=this;this.isActive=false;this.metaHash={};this.get=function(id){return _this.metaHash[id]||false};this.build=function(src){$http.get(src,{cache:true}).success(function(result){_this.isActive=true;for(var id in result){var description=result[id].description?result[id].description+"<br />":"";var credit=result[id].credit||"";_this.metaHash[id]=$sce.trustAsHtml((description+credit).replace("\n","<br />\n"))}})}});app.service("miaObjectMetaAdapter",function($http,$sce,envConfig){var _this=this;this.isActive=envConfig.miaObjectMetaActive;this.metaHash={};this.get=function(id,grouping){var id=parseInt(id);try{if(_this.metaHash[id]!==undefined){var hash=_this.metaHash[id];return grouping?hash[grouping]:hash}else{return this.getFromAPI(id,grouping)}}catch(e){console.log("error in objectMeta.get",e);return null}};this.getFromAPI=function(id,grouping){var apiURL=envConfig.miaObjectMetaSrc+id;return $http.get(apiURL,{cache:true}).then(function(result){var data=result.data;_this.addObjectToMetaHash(data.id.split("/").reverse()[0],data);return _this.get(id,grouping)})};this.addObjectToMetaHash=function(id,json){var groupings={},artist,culture,country,dated,medium,dimension,creditline,accession_number,trustedDescription;artist=json.artist||"Artist unknown";culture=json.culture||"";country=json.country||"";dated=json.dated||"";medium=json.medium||"";dimension=json.dimension||"";creditline=json.creditline||"";accession_number=json.accession_number||"";trustedDescription=$sce.trustAsHtml(json.description);groupings.meta1=artist+", "+(culture&&culture+", ")+country;groupings.meta2=dated;groupings.meta3=$sce.trustAsHtml((medium&&medium+"<br />")+(dimension&&dimension+"<br />")+(creditline&&creditline+"<br />")+accession_number);groupings.gw_title=$sce.trustAsHtml(json.title);groupings.gw_meta2=$sce.trustAsHtml((creditline&&creditline+"<br />")+accession_number);groupings.location=json.room.replace("G","");this.metaHash[id]=groupings;return groupings}});app.service("miaThumbnailAdapter",function(){var _this=this;this.isActive=false;this.cdn="";this.init=function(cdn){_this.isActive=true;_this.cdn=cdn};this.get=function(id){if(id===undefined)return;var trimmed_id=id.replace(".tif","");return _this.cdn+"thumbs/tn_"+trimmed_id+".jpg"}})},{}],3:[function(require,module,exports){var fastclick=require("fastclick");"use strict";window.app=angular.module("griot",["ngRoute"]);app.run(function(){fastclick(document.body)});require("./routes");require("./services/hintManager");require("./config");app.config(["$httpProvider",function($httpProvider){return delete $httpProvider.defaults.headers.common["X-Requested-With"]}]);app.run(["$rootScope","envConfig","miaMediaMetaAdapter","miaObjectMetaAdapter","miaThumbnailAdapter","$location","hintManager",function(root,config,mediaMeta,objectMeta,objectThumb,$location,hintManager){root.cdn=config.cdn;var query=$location.search();if(config.miaMediaMetaActive){mediaMeta.build(config.miaMediaMetaSrc)}if(config.miaThumbnailActive){objectThumb.init(config.miaThumbnailSrc)}}]);require("./factories");require("./adapters");require("./controllers/object");require("./controllers/story");require("./controllers/notes");require("./controllers/main");require("./controllers/goldweights");require("./directives/flatmap");require("./directives/note");require("./directives/vcenter");require("./directives/ngPoster");require("./directives/transparentize");require("./directives/drawerify");require("./directives/recalculateDrawerStates");require("./directives/share");require("./directives/videoHandler");require("./directives/hint")},{"./adapters":2,"./config":4,"./controllers/goldweights":5,"./controllers/main":6,"./controllers/notes":7,"./controllers/object":8,"./controllers/story":9,"./directives/drawerify":10,"./directives/flatmap":11,"./directives/hint":12,"./directives/ngPoster":13,"./directives/note":14,"./directives/recalculateDrawerStates":15,"./directives/share":16,"./directives/transparentize":17,"./directives/vcenter":18,"./directives/videoHandler":19,"./factories":20,"./routes":21,"./services/hintManager":22,fastclick:23}],4:[function(require,module,exports){app.constant("envConfig",{tilesaw:"//tiles.dx.artsmia.org/",tileUrlSubdomain:function(tileUrl){return tileUrl.replace("http://0.","http://{s}.")},crashpad:"http://new.artsmia.org/crashpad/griot/",cdn:"http://cdn.dx.artsmia.org/",miaEmailSharingActive:true,emailServer:"http://dx.artsmia.org:33445/",miaMediaMetaActive:true,miaMediaMetaSrc:"http://cdn.dx.artsmia.org/credits.json",miaObjectMetaActive:true,miaObjectMetaSrc:"http://caption-search.dx.artsmia.org/id/",miaThumbnailActive:true,miaThumbnailSrc:"http://cdn.dx.artsmia.org/"})},{}],5:[function(require,module,exports){app.controller("goldweightsCtrl",["$scope","$sce","notes","miaObjectMetaAdapter","miaThumbnailAdapter",function($scope,$sce,wp,objectMeta,objectThumb){wp().then(function(wordpress){window.$scope=$scope;Zoomer.windowResized();$scope.goldweights=wordpress.objects["196"];$scope.goldweights.trustedDescription=$sce.trustAsHtml($scope.goldweights.description);$scope.showDescription=true;var loadNotes=function(){$scope.notes=$scope.goldweights.views;angular.forEach($scope.notes,function(view){angular.forEach(view.annotations,function(ann){var proverbLinkPattern=/\n?<p>\[(PR\d+)\]<\/p>/,match=ann.description.match(proverbLinkPattern),proverbId=match&&match[1];ann.proverb=proverbId;ann.trustedAudio=$sce.trustAsResourceUrl($scope.cdn+"goldweights/"+proverbId+".mp3");ann.trustedDescription=$sce.trustAsHtml(ann.description.replace(proverbLinkPattern,""));angular.forEach(ann.attachments,function(att){var mash=att.image_id.split(" ");att.image_id=mash[0];att.object_id=mash[1];att.meta1=att.metaG="";if(objectMeta.isActive){att.title=objectMeta.get(att.object_id,"gw_title");att.meta1=objectMeta.get(att.object_id,"meta1");att.meta2=objectMeta.get(att.object_id,"gw_meta2")}if(objectThumb.isActive){att.thumb=objectThumb.get(att.image_id)}})})});$scope.$$phase||$scope.$apply()};$scope.$on("viewChanged",loadNotes);if($scope.mapLoaded)loadNotes()});$scope.play=function(scope,$event){$("audio").each(function(){this.pause()});var audio=$event.target.querySelector("audio");audio.paused?audio.play():audio.pause();scope.playing=!audio.paused;audio.addEventListener("ended",function(){scope.playing=false;scope.$apply()})};$scope.toggle=function(scope){$scope.popupWeight=$scope.popupWeight==scope?undefined:scope};$scope.toggleInfo=function(scope){$scope.showInfo=!$scope.showInfo};if(window.location.href.match(/west/)){$("body").addClass("west");setTimeout(function(){window.scrollTo(0,document.body.scrollHeight)},1e3)}$scope.home=function(){angular.forEach($scope.notes[0].annotations,function(note){note.active=false});$scope.$$phase||$scope.$apply()}}])},{}],6:[function(require,module,exports){app.controller("mainCtrl",["$scope","$routeParams","$rootScope","$timeout","orderByFilter","miaThumbnailAdapter","$sce","resolvedNotes","initIsotope","$location",function($scope,$routeParams,$rootScope,$timeout,orderByFilter,thumbnailAdapter,$sce,notes,initIsotope,$location){var dc=$rootScope.defaultCluster;if(dc&&dc!=="highlights")$location.path("/clusters/"+$rootScope.defaultCluster);var data=$scope.data=notes;$rootScope.loaded=false;var cluster=$rootScope.defaultCluster||$routeParams.cluster||"highlights";var clusterObjectIds=data.clusters[cluster.replace(/^(g)?(\d+)/i,"$1$2")];if(clusterObjectIds){$scope.cluster=$rootScope.defaultCluster=cluster;$scope.isGallery=cluster.match(/^G\d/i);$scope.gallery=$scope.cluster.replace("G","");$rootScope.showingCluster=$scope.showingCluster=typeof $rootScope.showingCluster==="undefined"?true:$rootScope.showingCluster;if(!$rootScope.clusterObjects){$scope.clusterObjects=clusterObjectIds.map(function(objectId){var isStory=objectId.match&&objectId.match(/stories\/(\d+)/);if(isStory)return data.stories[isStory[1]];return data.objects[objectId]}).filter(function(o){return o});var startPanels=addPanelsToClusterObjects();$rootScope.clusterObjects=$scope.clusterObjects=orderByFilter($scope.clusterObjects,random);startPanels.map(function(p){$scope.clusterObjects.unshift(p)});$rootScope.allObjects=$scope.allObjects=$rootScope.allObjects=loadAllObjects()}else{$scope.clusterObjects=$rootScope.clusterObjects;$scope.allObjects=$rootScope.allObjects}if($rootScope.showingCluster){$scope.all=$scope.clusterObjects}else{$scope.all=$scope.allObjects}}else{$location.path("/")}$scope.toggleSeeAll=function(){$scope.loading=true;if(!$scope.showingCluster){$scope.all=$scope.clusterObjects}else{$scope.all=$scope.allObjects}$timeout(function(){$timeout(initIsotope,0);$scope.loading=false;$rootScope.showingCluster=$scope.showingCluster=!$scope.showingCluster},0)};function loadAllObjects(){var c=$scope.clusterObjects;var others=[];angular.forEach(data.objects,function(o){c.indexOf(o)>-1||others.push(o)});others=orderByFilter(others,random);angular.forEach(data.panels,function(p){if(c.indexOf(p)==-1&&p.position=="end")others.push(p)});return angular.copy(c).map(function(o){if(o.recordType=="panel")o.trustedContent=$sce.trustAsHtml(o.content);return o}).concat(others)}function addPanelsToClusterObjects(){var panels=[];angular.forEach(data.panels,function(p){panels.push(p)});panels.filter(function(p){return p.position=="random"}).map(function(p){$scope.clusterObjects.push(p)});return panels.filter(function(p){return p.position=="start"})}$rootScope.nextView=undefined;$timeout(initIsotope,0);function random(){return.5-Math.random()}if(!$rootScope.identifier){var adjs=["autumn","hidden","bitter","misty","silent","empty","dry","dark","summer","icy","delicate","quiet","white","cool","spring","patient","twilight","dawn","crimson","wispy","weathered","blue"],nouns=["waterfall","river","breeze","moon","rain","wind","sea","morning","snow","lake","sunset","pine","shadow","leaf","dawn","glitter","forest","hill","cloud","meadow","sun","glade","bird","brook","butterfly","bush","dew","dust","field","fire","flower"],number=Math.floor(Math.random()*100),name=adjs[Math.floor(Math.random()*(adjs.length-1))]+"-"+nouns[Math.floor(Math.random()*(nouns.length-1))]+"-"+number;$rootScope.identifier=name;analytics.identify(name)}analytics.track("Landed on the homepage");$rootScope.$watch("loaded",function(val){if(val&&$rootScope.lastObjectId){var lastObjContainer=$("a[href*="+$rootScope.lastObjectId+"]").parent();lastObjContainer&&lastObjContainer[0].scrollIntoView()}})}])},{}],7:[function(require,module,exports){app.controller("notesCtrl",["$scope","$routeParams","notes",function($scope,$routeParams,wp){$scope.id=$routeParams.id;wp().then(function(_wp){$scope.notes=_wp.objects[$scope.id].views;$scope.$apply()})}])},{}],8:[function(require,module,exports){app.controller("ObjectCtrl",["$scope","$routeParams","$location","$sce","resolvedNotes","$rootScope","miaMediaMetaAdapter","miaObjectMetaAdapter","miaThumbnailAdapter","email","envConfig","$timeout","resolvedObjectMeta",function($scope,$routeParams,$location,$sce,notes,$rootScope,mediaMeta,objectMetaAdapter,miaThumbs,email,config,$timeout,objectMeta){$scope.movedZoomer=false;$scope.currentAttachment=null;$scope.contentMinimized=window.outerWidth<1024;$scope.enableSharing=config.miaEmailSharingActive;$scope.translucent=false;$scope.id=$routeParams.id;$rootScope.lastObjectId=$scope.id=$routeParams.id;_wp=notes;$scope.wp=_wp.objects[$scope.id];analytics.track("Browsed an Object",{id:$scope.id,name:$scope.wp.title});$scope.wp.meta3=$sce.trustAsHtml($scope.wp.meta3);if(objectMetaAdapter.isActive){$scope.wp.meta1=$scope.wp.meta1||objectMeta.meta1;$scope.wp.meta2=$scope.wp.meta2||objectMeta.meta2;$scope.wp.meta3=$scope.wp.meta3||objectMeta.meta3;$scope.wp.location=objectMeta.location}$scope.relatedStories=[];angular.forEach($scope.wp.relatedStories,function(story_id){if(_wp.stories[story_id]){$scope.relatedStories.push({id:story_id,title:_wp.stories[story_id].title})}});if($scope.wp){$scope.mainImage=$scope.wp.views[0].image;$scope.wp.trustedDescription=$sce.trustAsHtml($scope.wp.description);$scope.$on("viewChanged",loadDetails);$scope.$watch("mapLoaded",function(v){v&&loadDetails()});if($rootScope.nextView){$scope.activeSection=$rootScope.nextView;$rootScope.nextView=undefined;var drawer=angular.element($(".object-content-container")).scope().drawerify;if(drawer)drawer.to("open",0)}$scope.$$phase||$scope.$apply()}var loadDetails=function(){$scope.notes=$scope.wp.views;$scope.allNotes=[];$scope.allAttachments=[];angular.forEach($scope.notes,function(view){angular.forEach(view.annotations,function(ann){ann.trustedDescription=$sce.trustAsHtml(ann.description);ann.view=view;$scope.allNotes.push(ann);angular.forEach(ann.attachments,function(att){att.thumbnail=miaThumbs.get(att.image_id);if(mediaMeta.isActive){att.meta=mediaMeta.get(att.image_id)||(typeof att.meta==="object"?att.meta:$sce.trustAsHtml(att.meta))}att.trustedDescription=$sce.trustAsHtml(att.description);$scope.allAttachments.push(att)})})});$scope.$$phase||$scope.$apply()};$scope.next=function(direction){var next=$scope.objects.ids[$scope.objects.ids.indexOf(parseInt($scope.id))+1];if(next)$location.url("/o/"+next)};$scope.prev=function(direction){var prev=$scope.objects.ids[$scope.objects.ids.indexOf(parseInt($scope.id))-1];if(prev)$location.url("/o/"+prev)};$scope.viewEnabled=function(nextView,debug){return nextView=="more"&&$scope.relatedStories&&$scope.relatedStories.length>0||nextView=="annotations"&&getFirstDetail()||nextView=="about"};function getFirstDetail(){var i=0,view=$scope.notes&&$scope.notes[i],firstDetail;while(view&&view.annotations.length==0){view=$scope.notes&&$scope.notes[i];i++}firstDetail=view&&view.annotations&&view.annotations[0];return firstDetail}$scope.toggleView=function(nextView,dontTrack){if(!dontTrack)analytics.track("Changed Sections within an Object",{view:nextView});nextView=nextView||"about";if(!$scope.viewEnabled(nextView))return;if(nextView=="annotations"){if(!$scope.notes)$scope.notes=$scope.wp.views;var firstDetail=getFirstDetail();if(firstDetail&&!$scope.flatmapScope.lastActiveNote){$scope.activateNote(firstDetail,$scope.notes[0])}else if($scope.flatmapScope.lastActiveNote){$scope.glanceText=$sce.trustAsHtml("Press to view detail <span class='annotation-index'>"+$scope.flatmapScope.lastActiveNote.index+"</span>");if(!$scope.flatmapScope.zoom.map.getBounds().contains($scope.flatmapScope.jsonLayer.getBounds())){$scope.$broadcast("changeGeometry",$scope.flatmapScope.lastActiveNote.geoJSON.geometry)}}}else{$scope.glanceText=$sce.trustAsHtml("Press to view object")}if(nextView=="about"&&$scope.flatmapScope&&$scope.notes[0].image!=$scope.flatmapScope.image){$scope.activateView($scope.notes[0])}$scope.activeSection=nextView};$scope.toggleAttachment=function(attachment,closeAttachmentIfOpen,$event){if($scope.currentAttachment==attachment){if(!closeAttachmentIfOpen)return;$scope.currentAttachment=$scope.showAttachmentCredits=null}else{$scope.currentAttachment=attachment;$scope.showAttachmentCredits=false;setTimeout(Zoomer.windowResized,0)}if($event)$event.stopPropagation()};$scope.toggleAttachmentCredits=function(attachment){$scope.showAttachmentCredits=!$scope.showAttachmentCredits;setTimeout(Zoomer.windowResized,125)};$scope.toggleView($scope.activeSection,true);$scope.$on("showAnnotationsPanel",function(view){$scope.activeSection="annotations"});$scope.changeZoomerForViews=function(map,flatmapScope){$scope.$apply(function(){$scope.showViews=true})};$scope.activateNote=function(note,view){$scope.showViews=false;$scope.activeView=view;note.active=!note.active;$scope.glanceText=$sce.trustAsHtml("Press to view detail <span class='annotation-index'>"+note.index+"</span>")};$scope.deactivateAllNotes=function(){angular.forEach($scope.notes,function(view){angular.forEach(view.annotations,function(ann){ann.active=false})});$scope.$$phase||$scope.$apply()};$scope.activateView=function(view){$scope.showViews=false;$scope.activeView=view;$scope.deactivateAllNotes();$scope.flatmapScope.$broadcast("changeView",view)};$scope.activateViewAndShowFirstAnnotation=function(view){$scope.activateView(view);var note=view.annotations[0];if(note)activateNote(note)};$scope.toggleSixbar=function(element){$scope.sixBarClosed=!$scope.sixBarClosed;setTimeout(Zoomer.windowResized,0)};$scope.toggleExtendedTombstone=function(event){$scope.showExtendedTombstone=!$scope.showExtendedTombstone;$scope.$broadcast("recalculateCustomDrawerStates");if(event)event.stopPropagation()};$scope.toggleMinimizeContent=function(){$scope.contentMinimized=!$scope.contentMinimized};$scope.glanceText=$sce.trustAsHtml("Press to view object")}])},{}],9:[function(require,module,exports){app.controller("storyCtrl",["$scope","$routeParams","$sce","notes","miaMediaMetaAdapter","$rootScope",function($scope,$routeParams,$sce,wp,mediaMeta,$rootScope){wp().then(function(wordpress){$scope.id=$routeParams.id;$scope.usingMediaAdapter=false;$scope.story=wordpress.stories[$scope.id];$scope.relatedObjects=[];angular.forEach($scope.story.relatedObjects,function(id){$scope.relatedObjects.push({id:id,title:wordpress.objects[id].title,image:wordpress.objects[id].views[0].image})});angular.forEach($scope.story.pages,function(page){if(page.text){var iframe_pattern=/<p>\[(http:\/\/.*)\]<\/p>/,match=page.text.match(iframe_pattern);if(match&&match[1]){page.iframe=$sce.trustAsResourceUrl(match[1]);page.text=page.text.replace(/<p>\[(http:\/\/.*)\]<\/p>/,"").trim()}page.trustedText=$sce.trustAsHtml(page.text.replace(/<p>(&nbsp;)?<\/p>/,""))}page.trustedVideo=$sce.trustAsResourceUrl(page.video);page.poster=$sce.trustAsResourceUrl(page.video+".jpg");page.contentMinimized=false;page.toggleMinimizeContent=function(){this.contentMinimized=!this.contentMinimized;setTimeout(Zoomer.windowResized,100)};page.meta=$sce.trustAsHtml(page.meta);page.metaB=$sce.trustAsHtml(page.metaB);if(mediaMeta.isActive){var key=null,keyB=null;switch(page.type){case"text":break;case"video":key=page.video;break;case"image":key=page.image;break;case"comparison":key=page.image;keyB=page.imageB;break}if(key){page.meta=mediaMeta.get(key)||page.meta}if(keyB){page.metaB=mediaMeta.get(keyB)||page.metaB}}switch(page.type){case"video":page.glanceText="Tap to play video";break;case"image":page.glanceText="Press to view image";break;case"comparison":page.glanceText="Press to view images";break;default:page.glanceText="Press to view"}});analytics.track("Opened a Story",{id:$scope.id,name:$scope.story.title})});setTimeout(Zoomer.windowResized,100);$scope.storyMenuOpen=false;$scope.toggleStoryMenu=function(){$scope.storyMenuOpen=!$scope.storyMenuOpen};$scope.activePage=0;$scope.updateActivePage=function(newPage){if(newPage>-1&&newPage<$scope.story.pages.length){$scope.activePage=newPage;analytics.track("Paged a Story",{id:$scope.id,name:$scope.story.title,page:newPage})}setTimeout(Zoomer.windowResized,200)};$scope.backToObject=function(){$rootScope.nextView="more";if(history.length>1){history.back()}else{window.location=window.location.origin+window.location.pathname}}}])},{}],10:[function(require,module,exports){app.directive("drawerify",function($timeout){return{restrict:"A",transclude:true,replace:true,template:"<div class='drawerify-drawer' ng-class=\"{'drawerify-horizontal':drawerify.orientation == 'horizontal', 'drawerify-vertical':drawerify.orientation == 'vertical', 'drawerify-full':drawerify.fullWidth, 'drawerify-open': drawerify.activeState == 'open', 'drawerify-closed':drawerify.activeState == 'closed', 'drawerify-info':drawerify.activeState == 'info' }\">"+"<div class='drawerify-content' ng-transclude></div>"+"<a class='drawerify-handle' ng-class=\"{'drawerify-collapsed':drawerify.collapseHandle && drawerify.states[ drawerify.activeState ].handleState == 'collapsed' } \"></a>"+"</div>",controller:function($scope,$element,$attrs){var _this=this;$scope.drawerify=this;this._chooseBreakpoint=function(){var currentBpInt=1e4;var windowWidth=window.innerWidth;var breakpoint="default";for(var userBreakpoint in this.breakpoints){var bpInt=parseInt(userBreakpoint);if(bpInt>=windowWidth&&bpInt<currentBpInt){currentBpInt=bpInt;breakpoint=userBreakpoint}}return breakpoint};this._getDrawerWidth=function(){var widthLimit=Math.min(this.containerWidth,this.maxWidth);if("horizontal"==this.orientation&&widthLimit+this.handleWidth>this.containerWidth){widthLimit=this.containerWidth-this.handleWidth-10}return widthLimit};this._getDrawerHeight=function(){var heightLimit=this.containerHeight;if("vertical"==this.orientation){heightLimit=this.containerHeight-this.handleHeight-10}return heightLimit};this._getDrawerStaticStyles=function(){var drawerStyles={position:"absolute",visibility:"visible",width:this.drawerWidth+"px",height:this.drawerHeight+"px","z-index":1e3};if("vertical"==this.orientation&&"left"==this.attachTo){drawerStyles.top="auto";drawerStyles.right="auto";drawerStyles.left="0"}else if("vertical"==this.orientation&&"right"==this.attachTo){drawerStyles.top="auto";drawerStyles.right="0";drawerStyles.left="auto"}else if("horizontal"==this.orientation&&"left"==this.attachTo){drawerStyles.top="0";drawerStyles.right="auto";drawerStyles.bottom="0"}else if("horizontal"==this.orientation&&"right"==this.attachTo){drawerStyles.top="0";drawerStyles.bottom="0";drawerStyles.left="auto"}return drawerStyles};this._getHandleStaticStyles=function(){var handleStyles={display:"block"};if("vertical"==this.orientation&&"left"==this.attachTo){handleStyles.right="auto";handleStyles.bottom="auto";handleStyles.left="0"}else if("vertical"==this.orientation&&"right"==this.attachTo){handleStyles.right="0";handleStyles.bottom="auto";handleStyles.left="auto"}else if("horizontal"==this.orientation&&"left"==this.attachTo){handleStyles.top="auto";handleStyles.right="auto";handleStyles.bottom="0"}else if("horizontal"==this.orientation&&"right"==this.attachTo){handleStyles.top="auto";handleStyles.right=this.drawerWidth+"px";handleStyles.bottom="0"}return handleStyles};this._getHandleStates=function(){var handleStates;if("vertical"==this.orientation){handleStates={collapsed:{top:"0"},expanded:{top:"-"+this.handleHeight+"px"}}}else if("horizontal"==this.orientation&&"left"==this.attachTo){handleStates={collapsed:{left:this.drawerWidth-this.handleWidth+"px"},expanded:{left:this.drawerWidth+"px"}}}else if("horizontal"==this.orientation&&"right"==this.attachTo){handleStates={collapsed:{right:this.drawerWidth-this.handleWidth+"px"},expanded:{right:this.drawerWidth+"px"}}}return handleStates};this._getOpenState=function(){var pageLocation,openStyles={};if("vertical"==this.orientation){pageLocation=this.containerBottom-this.drawerHeight;openStyles.bottom="0"}else if("horizontal"==this.orientation&&"left"==this.attachTo){pageLocation=this.containerLeft+this.drawerWidth;openStyles.left="0"}else if("horizontal"==this.orientation&&"right"==this.attachTo){pageLocation=this.containerRight-this.drawerWidth;openStyles.right="0"}return{css:openStyles,pageLocation:pageLocation,handleState:"collapsed"}};this._getClosedState=function(){var pageLocation,closedStyles={};if("vertical"==this.orientation){pageLocation=this.containerBottom;closedStyles.bottom="-"+this.drawerHeight+"px"}else if("horizontal"==this.orientation&&"left"==this.attachTo){pageLocation=this.containerLeft;closedStyles.left="-"+this.drawerWidth+"px"}else if("horizontal"==this.orientation&&"right"==this.attachTo){pageLocation=this.containerRight;closedStyles.right="-"+this.drawerWidth+"px"}return{css:closedStyles,pageLocation:pageLocation,handleState:"expanded"}};this._getCustomState=function(stateName,initial){var initial=typeof initial!=="undefined"?initial:false;var pageLocation,customStyles,handleState;var selector=this.customStates[stateName];var $el=$(selector);var elPosition=$el.position().top;var elHeight=$el.outerHeight();var elTotalHeight=elPosition+elHeight+10;var heightDifference=this.drawerHeight-elTotalHeight;pageLocation=this.containerBottom-elTotalHeight;customStyles={bottom:"-"+heightDifference+"px"};handleState=elTotalHeight<this.handleHeight?"expanded":"collapsed";if(initial){var cancel=$scope.$watch(function(){return $el.height()+$el.position().top},function(){$scope.drawerify.states[stateName]=$scope.drawerify._getCustomState(stateName,false);if($scope.drawerify.activeState==stateName){$scope.drawerify.to(stateName)}});$scope.$on("drawerTouched",function(){cancel()})}return{css:customStyles,pageLocation:pageLocation,handleState:handleState}};this._getDragLimits=function(){var limits={};if("vertical"==this.orientation){limits.minPageY=this.containerBottom-this.drawerHeight;limits.maxPageY=this.containerBottom}else if("horizontal"==this.orientation&&"left"==this.attachTo){limits.minPageX=this.containerLeft;limits.maxPageX=this.containerLeft+this.drawerWidth}else if("horizontal"==this.orientation&&"right"==this.attachTo){limits.minPageX=this.containerRight-this.drawerWidth;limits.maxPageX=this.containerRight}return limits};this._track=function(touch){this.isMoving=true;this.activeState=null;var trackStyles={};if("vertical"==this.orientation){if(touch.pageY<this.limits.minPageY||touch.pageY>this.limits.maxPageY){return}trackStyles.bottom="-"+(this.drawerHeight-(this.containerBottom-touch.pageY))+"px"}else if("horizontal"==this.orientation){if(touch.pageX<this.limits.minPageX||touch.pageX>this.limits.maxPageX){return}if("left"==this.attachTo){trackStyles.left=touch.pageX-this.drawerWidth}else if("right"==this.attachTo){trackStyles.right="-"+(this.drawerWidth-(this.containerRight-touch.pageX))+"px"}}this.drawer.css(trackStyles)};this._untrack=function(touch){this.isMoving=false;console.log(this.touchstart);console.log(this.touchend);if(Math.abs(this.touchstart-this.touchend)<50){this.toggle();return}var closestStateDistance=null;var key=this.orientation=="vertical"?"pageY":"pageX";var position=touch[key];this.toNearestState(position)};this.init=function(){var props;this.drawer=$($element[0]);this.handle=this.drawer.children(".drawerify-handle");this.container=this.drawer.offsetParent();this.breakpoints=$scope.$eval($attrs.drawerify);this.activeBreakpoint=this._chooseBreakpoint();props=this.breakpoints[this.activeBreakpoint]||"disabled";if("disabled"==props){this.disable();return}this.orientation=props.orientation||"vertical";this.attachTo=props.attachTo||"right";this.startingState=props.startingState||"open";this.maxWidth=props.maxWidth||-1;this.customStates=props.customStates||null;this.collapseHandle=props.collapseHandle||false;this.containerWidth=this.container.width();this.containerHeight=this.container.height();this.containerTop=this.container.offset().top;this.containerBottom=this.containerTop+this.containerHeight;this.containerLeft=this.container.offset().left;this.containerRight=this.containerLeft+this.containerWidth;this.defaultSpeed=300;this.handleWidth=70;this.handleHeight=70;this.drawerWidth=this._getDrawerWidth();this.fullWidth=this.orientation=="vertical"&&this.drawerWidth==this.containerWidth;this.drawerHeight=this._getDrawerHeight();this.limits=this._getDragLimits();this.drawer.css(this._getDrawerStaticStyles());this.handle.css(this._getHandleStaticStyles());this.states={open:this._getOpenState(),closed:this._getClosedState()};if("vertical"==this.orientation){for(stateName in this.customStates){this.states[stateName]=this._getCustomState(stateName,true)}}this.handleStates=this._getHandleStates();this.to(this.startingState,0);$scope.$broadcast("drawerInitialized",this.drawer);$scope.$emit("drawerInitialized",this.drawer)};this.recalculateCustomStates=function(){if("vertical"==this.orientation){for(stateName in this.customStates){this.states[stateName]=this._getCustomState(stateName)}}};this.to=function(state,transition){var transition=typeof transition!=="undefined"?transition:this.defaultSpeed;this.drawer.animate(this.states[state].css,transition);if(this.collapseHandle){this.handle.animate(this.handleStates[this.states[state].handleState],100)}else{this.handle.animate(this.handleStates["expanded"],100)}this.activeState=state};this.toNearestState=function(position){var distanceToClosestState=null;for(var state in this.states){var distance=Math.abs(position-this.states[state].pageLocation);if(!distanceToClosestState||distance<distanceToClosestState){closestState=state;distanceToClosestState=distance}}this.to(closestState)};this.toggle=function(){if(this.activeState=="open"){this.to("closed")}else{this.to("open")}};this.disable=function(){this.handle.hide();this.managedProperties=["position","top","right","bottom","left","width","height","z-index"];angular.forEach(this.managedProperties,function(property){$scope.drawerify.drawer.css(property,"")})}},link:function(scope,elem,attrs){scope.drawerify.init();scope.drawerify.container.on("touchstart mousedown",function(){scope.$broadcast("drawerTouched")});scope.drawerify.handle.on("touchstart",function(e){var touch=e.originalEvent.targetTouches[0];if("vertical"===scope.drawerify.orientation){scope.drawerify.touchstart=touch.pageY}else{scope.drawerify.touchstart=touch.pageX}});scope.drawerify.handle.on("touchmove",function(e){var touch=e.originalEvent.targetTouches[0];scope.drawerify._track(touch)});scope.drawerify.handle.on("touchend mouseup",function(e){if(e.originalEvent instanceof MouseEvent){scope.$apply(function(){scope.drawerify.toggle()
});return}var touch=e.originalEvent.changedTouches[0];if("vertical"===scope.drawerify.orientation){scope.drawerify.touchend=touch.pageY}else{scope.drawerify.touchend=touch.pageX}if(scope.drawerify.isMoving){scope.$apply(function(){scope.drawerify._untrack(touch)})}else{scope.$apply(function(){scope.drawerify.toggle()})}e.preventDefault()});$(window).on("resize orientationchange",function(){scope.drawerify.init()})}}})},{}],11:[function(require,module,exports){app.directive("flatmap",function(tilesaw,envConfig,$rootScope){return{restrict:"E",scope:{json:"@",image:"@"},replace:true,transclude:true,template:'<div id="{{container}}" class="flatmap" ng-class="{zoomed: zoomed}"><div ng-transclude></div></div>',controller:function($scope,$element,$attrs){var scope=$scope;scope.$parent.flatmapScope=scope;scope.zoomed=$rootScope.zoomed;var removeJsonLayer=function(){if(scope.jsonLayer)scope.zoom.map.removeLayer(scope.jsonLayer);if(scope.inverseLayer)scope.zoom.map.removeLayer(scope.inverseLayer)};var showJsonLayer=function(fadeAfter,inverse){if(!scope.jsonLayer)return;var layerStyle={stroke:true,fill:false,weight:2,color:"#eee",opacity:"0.5"},addLayer=null;if(inverse){var holes=[];scope.jsonLayer._latlngs?holes.push(scope.jsonLayer._latlngs):scope.jsonLayer.eachLayer(function(l){holes.push(l._latlngs)});scope.inverseLayer=L.polygon([scope.zoom.imageBounds.toPolygon()._latlngs].concat(holes));scope.inverseLayer.setStyle({fill:true,fillColor:"#000",fillOpacity:"0.5",stroke:false});addLayer=scope.inverseLayer}else{scope.jsonLayer.setStyle(layerStyle);addLayer=scope.jsonLayer}scope.zoom.map.addLayer(addLayer)};var loadImage=function(image){if(image==="undefined"||image==="")return;scope.viewChanging=true;scope.image=image;removeJsonLayer();scope.jsonLayer=null;tilesaw.get(image).then(function(tileJson){$("#"+scope.container).find(".leaflet-tile-pane").css("visibility","visible");var tileUrl=envConfig.tileUrlSubdomain(tileJson.tiles[0]);scope.$parent.$parent.tileJson=tileJson;scope.$parent.$parent.imageAspectRatio=tileJson.width/tileJson.height;scope.zoom=Zoomer.zoom_image({container:scope.container,tileURL:tileUrl,imageWidth:tileJson.width,imageHeight:tileJson.height});scope.$emit("viewChanged");scope.$parent.mapLoaded=true;var watchForZoom=scope.zoom.map.on("zoomstart",function(){scope.$emit("zoom");scope.$$phase||$rootScope.$$phase||scope.$apply(function(){$rootScope.zoomed=scope.zoomed=true});scope.zoom.map.off(watchForZoom)})})};loadImage(scope.image);var annotateAndZoom=function(geometry){removeJsonLayer();if(geometry){if(geometry._initHooksCalled){scope.jsonLayer=geometry}else{scope.jsonLayer=L.GeoJSON.geometryToLayer(geometry)}}if(scope.viewChanging)return;if(scope.jsonLayer){scope.$parent.$broadcast("showAnnotationsPanel","annotations");var map=scope.zoom.map,mapBounds=map.getBounds(),jsonLayerBounds=scope.jsonLayer.getBounds(),delay=0;if(mapBounds.intersects(jsonLayerBounds)||mapBounds.contains(jsonLayerBounds)){}else{setTimeout(function(){map.zoomOut(100)},300);delay=1e3}setTimeout(function(){showJsonLayer(3e3,true)},delay);setTimeout(function(){map.fitBounds(scope.jsonLayer.getBounds())},delay+250)}};scope.$on("changeGeometry",function(event,geometry){annotateAndZoom(geometry)},true);scope.$on("viewChanged",function(event,message){scope.viewChanging=false;annotateAndZoom()},true);scope.$on("changeView",function(event,message){if(message.image!=scope.image)loadImage(message.image)});scope.$on("viewChanged",function(){scope.zoom.map.on("zoomedBeyondMin",function(e){if(scope.$parent&&scope.$parent.notes&&scope.$parent.notes.length>1&&scope.$parent.changeZoomerForViews)scope.$parent.changeZoomerForViews(this,scope)})});return{loadImage:loadImage,annotateAndZoom:annotateAndZoom,removeJsonLayer:removeJsonLayer,showJsonLayer:showJsonLayer,scope:scope}},link:function(scope,element,attrs){scope.container="zoom-"+scope.image+"-"+(new Date).getUTCMilliseconds();element.attr("id",scope.container)}}})},{}],12:[function(require,module,exports){app.directive("hint",function($rootScope){return function(scope,elem,attrs){$rootScope.hintSeen=true}})},{}],13:[function(require,module,exports){app.directive("ngPoster",function(){return{priority:99,link:function(scope,element,attr){attr.$observe("ngPoster",function(value){if(!value)return;attr.$set("poster",value)})}}})},{}],14:[function(require,module,exports){app.directive("note",function($sce){var divIcon=L.divIcon({className:"noteMarker"});return{restrict:"E",controller:function($scope){},require:"^flatmap",link:function(scope,element,attrs,flatmapCtrl){var jsonToLayer=function(note){var geometry,json;if(note.type=="FeatureCollection"){json={type:"MultiPolygon",coordinates:[].map.call(note.features,function(f){return[f.geometry.coordinates[0]]})}}else{json=note.geometry}return L.GeoJSON.geometryToLayer(json)};var eachMarker=function(callback){angular.forEach(scope.markers,callback)},eachLayer=function(layer,callback){layer.eachLayer?layer.eachLayer(callback):callback(layer)};scope.flatmapCtrl=flatmapCtrl;scope.map=scope.flatmapCtrl.scope.zoom.map;scope.jsonLayer=jsonToLayer(scope.note.geoJSON);scope.note.index=scope.$parent.$parent.noteCount=(scope.$parent.$parent.noteCount||0)+1;divIcon.options.html="<span>"+scope.note.index+"</span>";scope.markers=[];eachLayer(scope.jsonLayer,function(layer){scope.markers.push(L.marker(layer.getBounds().getCenter(),{icon:divIcon}))});scope.note.active=false;var zoomNote=function(){flatmapCtrl.scope.$broadcast("changeView",scope.view);flatmapCtrl.scope.$broadcast("changeGeometry",scope.jsonLayer);scope.note.active=true;scope.$$phase||scope.$apply();scrollNoteTextIntoView()};var scrollNoteTextIntoView=function(){var noteEl=$("#annotations li.note:nth-child("+(scope.$index+1)+")")[0];if(noteEl)noteEl.scrollIntoViewIfNeeded&&noteEl.scrollIntoViewIfNeeded()||noteEl.scrollIntoView()};var toggleNoteZoom=function(){scope.$apply(function(){scope.note.active=!scope.note.active})};scope.$watch("note.active",function(newVal,oldVal){var openedOrClosed=undefined;if(!newVal&&oldVal&&scope.note==flatmapCtrl.scope.lastActiveNote){flatmapCtrl.removeJsonLayer();scope.map.zoomOut(100);flatmapCtrl.scope.lastActiveNote=null;openedOrClosed="Closed"}else if(newVal&&!oldVal){var lastNote=flatmapCtrl.scope.lastActiveNote,note=scope.note;if(lastNote)lastNote.active=false;zoomNote();flatmapCtrl.scope.lastActiveNote=scope.note;openedOrClosed="Opened";scope.$parent.$parent.$parent.glanceText=$sce.trustAsHtml("Press to view detail <span class='annotation-index'>"+scope.note.index+"</span>");scope.$$phase||scope.$apply()}if(openedOrClosed)analytics.track(openedOrClosed+" a Detail",{title:scope.note.title,index:scope.note.index,id:flatmapCtrl.scope.$parent.id});var layer=scope.jsonLayer,index=0;eachLayer(layer,function(_layer){scope.markers[index].setLatLng(newVal?_layer._latlngs[0]:_layer.getBounds().getCenter());index++})});flatmapCtrl.scope.$watch("image",function(newVal,oldVal){eachMarker(function(marker){if(newVal==scope.$parent.view.image){marker.setOpacity(1);marker.on("click",toggleNoteZoom)}else{marker.setOpacity(0);marker.off("click",toggleNoteZoom)}})});eachMarker(function(marker){marker.addTo(scope.map)})}}})},{}],15:[function(require,module,exports){app.directive("recalculateDrawerStates",function($timeout){return{restrict:"A",require:"^drawerify",link:function(scope,elem,attrs,drawerify){elem.on("touchend",function(){if("vertical"===drawerify.orientation){$timeout(function(){drawerify.recalculateCustomStates();if("open"!==drawerify.activeState){drawerify.to("info")}},50)}})}}})},{}],16:[function(require,module,exports){app.directive("share",function(email){var template='<form name="share" ng-submit="sendEmail()">'+'<input id="shareEmail" type="email" ng-model="email" required></input>'+'<input type="submit" ng-disabled="!share.$valid" value="Email this page" ng-click="sendEmail()"></input>'+"</form>";return{restrict:"A",template:template,link:function(scope,element,attrs){scope.showEmail=false;scope.el=element;var emailI=scope.el.find("input")[0];scope.toggleEmail=function(e){if((e.toElement||e.target).nodeName=="A")scope.showEmail=!scope.showEmail;emailI.focus()};scope.sendEmail=function(){email.share(scope.email,{subject:scope.wp.title,body:window.location.href});scope.email="";scope.showEmail=false;emailI.blur()}}}})},{}],17:[function(require,module,exports){app.directive("transparentize",function($timeout){return{restrict:"A",require:"^?drawerify",link:function(scope,elem,attrs,drawerify){var $target=jQuery(attrs.transparentize);elem.on("touchstart mousedown",function(){if(attrs.hasOwnProperty("transparentizeAction")){switch(attrs.transparentizeAction){case"playVideo":if(drawerify){drawerify.to("closed");$timeout(function(){var $video=$('video[src="'+scope.page.video+'"]');$video[0].play()},150)}else{var $video=$('video[src="'+scope.page.video+'"]');$video[0].play()}break;default:$target.addClass("transparentized")}}else{$target.addClass("transparentized")}});elem.on("touchend mouseup",function(e){$target.addClass("detransparentized");$target.removeClass("transparentized");$timeout(function(){$target.removeClass("detransparentized")},300)})}}})},{}],18:[function(require,module,exports){app.directive("vcenter",function(){return{restrict:"C",transclude:true,template:"<div class='vcenter-table'><div class='vcenter-cell' ng-transclude></div></div>",link:function(scope,elem,attrs){scope.container=jQuery(elem);if(scope.container.find("video").length){var unwatch=scope.$watch(function(){return scope.container.height()},function(){setTimeout(function(){var finalHeight=scope.container.height();scope.container.find(".vcenter-cell").children("video").css("max-height",finalHeight)},150)});scope.$on("$destroy",function(){unwatch()})}}}})},{}],19:[function(require,module,exports){app.directive("videoHandler",function(){return function(scope,elem,attrs){var aspect=$(elem).innerHeight()/$(elem).innerWidth();var resize=function(){var containerWidth=$(elem).closest(".story-video").innerWidth();if(window.outerWidth>1023){containerWidth-=140}$(elem).css({width:containerWidth+"px",height:Math.round(containerWidth*aspect)+"px","max-width":"800px"})};resize();$(window).on("resize orientationchange",function(){setTimeout(function(){resize()},300)})}})},{}],20:[function(require,module,exports){app.factory("tilesaw",["$http","envConfig",function($http,config){return{get:function(image){return $http.get(config.tilesaw+image+".tif",{cache:true}).then(function(result){return result.data})}}}]);app.factory("notes",["$http","envConfig","miaThumbnailAdapter","$sce","$q",function($http,config,thumbs,$sce,$q){window.miaThumbnailAdapter=thumbs;window.$q=$q;return function(){var d=$q.defer();$http.get(config.crashpad,{cache:true}).then(function(result){result.data.clusters=require("../clusters/clusters.json");angular.forEach(result.data.objects,function(o){o.thumbnail=miaThumbnailAdapter.get(o.views[0].image);o.title=o.title.replace("&amp;","&")});angular.forEach(result.data.panels,function(panel){panel.trustedContent=$sce.trustAsHtml(panel.content)});return result.data}).then(function(data){var url="http://cdn.dx.artsmia.org/thumbs/artstories-image-dimensions.json";return $http.get(url,{cache:true}).then(function(result){var allImageDimensions=result.data;data.objects=angular.forEach(data.objects,function(o,id){var dimensions=allImageDimensions[o.views[0].image];if(!dimensions)return console.info("missing dimensions for",id,o.views[0].image);o.imageWidth=dimensions[0];o.imageHeight=dimensions[1]});d.resolve(data)})});return d.promise}}]);app.factory("email",["$http","envConfig",function($http,config){return{share:function(email,params){return $http.post(config.emailServer+email,params).success(function(response){return response})}}}]);app.factory("initIsotope",["$rootScope",function($rootScope){return function(){if(window.innerWidth<768){$rootScope.loaded=true;return}var cover=document.querySelector("#cover");this.iso=new Isotope(cover,{itemSelector:".isotope-item",layoutMode:"masonryHorizontal",masonryHorizontal:{rowHeight:300,gutter:2},containerStyle:null,isInitLayout:false});var centerCover=function(){var availableHeight=$(".cover-wrapper").height();var rowCount=Math.floor(availableHeight/302)||1;var newHeight=rowCount*302+1;var newTop=(availableHeight-newHeight)/2;$("#cover").css({height:newHeight+"px",top:newTop+"px"})};this.iso.on("layoutComplete",function(){centerCover();$(".cover-item").css({opacity:1});$rootScope.loaded=true});$(window).on("resize",function(){centerCover()});this.iso.layout()}}])},{"../clusters/clusters.json":1}],21:[function(require,module,exports){app.config(["$routeProvider",function($routeProvider){return $routeProvider.when("/",{templateUrl:"views/index.html",controller:"mainCtrl",resolve:{resolvedNotes:function(notes){return notes()}}}).when("/clusters/:cluster",{templateUrl:"views/index.html",controller:"mainCtrl",resolve:{resolvedNotes:function(notes){return notes()}}}).when("/o/:id",{templateUrl:"views/object.html",controller:"ObjectCtrl",resolve:{resolvedNotes:function(notes){return notes()},resolvedObjectMeta:function(miaObjectMetaAdapter,$route){return miaObjectMetaAdapter.get($route.current.params.id)}}}).when("/a/:id",{templateUrl:"views/annotations.html",controller:"notesCtrl"}).when("/stories/:id",{templateUrl:"views/story.html",controller:"storyCtrl"}).when("/goldweights",{templateUrl:"views/goldweights.html",controller:"goldweightsCtrl"}).otherwise({redirectTo:"/"})}])},{}],22:[function(require,module,exports){app.service("hintManager",function($location,$timeout,$rootScope){var _this=this;this.delay=60;$rootScope.hintSeen=false;this.init=function(){$rootScope.showHints=false;$rootScope.hintSeen=false;var query=$location.search();$rootScope.hosted=query.hasOwnProperty("hosted")&&query.hosted==="true";if(query.hasOwnProperty("touch")&&query.touch==="true"){this.setTouch()}else{$rootScope.touch=false}if(!$rootScope.touch){$(window).on("touchstart",_this.setTouch)}};this.setTouch=function(){$timeout(function(){$rootScope.touch=true;$rootScope.showHints=true;$(window).off("touchstart",_this.setTouch);if($rootScope.hosted){$(window).on("touchend",function(){_this.resetTimer(_this.delay)})}})};this.resetTimer=function(delay){if(_this.hasOwnProperty("hintTimer")){$timeout.cancel(_this.hintTimer)}_this.hintTimer=$timeout(function(){if($rootScope.touch){$rootScope.showHints=true}},delay*1e3)};$rootScope.$on("zoom",function(){if($rootScope.hintSeen){$timeout(function(){$rootScope.showHints=false})}})})},{}],23:[function(require,module,exports){(function(){"use strict";function FastClick(layer,options){var oldOnClick;options=options||{};this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=options.touchBoundary||10;this.layer=layer;this.tapDelay=options.tapDelay||200;this.tapTimeout=options.tapTimeout||700;if(FastClick.notNeeded(layer)){return}function bind(method,context){return function(){return method.apply(context,arguments)}}var methods=["onMouse","onClick","onTouchStart","onTouchMove","onTouchEnd","onTouchCancel"];var context=this;for(var i=0,l=methods.length;i<l;i++){context[methods[i]]=bind(context[methods[i]],context)}if(deviceIsAndroid){layer.addEventListener("mouseover",this.onMouse,true);layer.addEventListener("mousedown",this.onMouse,true);layer.addEventListener("mouseup",this.onMouse,true)}layer.addEventListener("click",this.onClick,true);layer.addEventListener("touchstart",this.onTouchStart,false);layer.addEventListener("touchmove",this.onTouchMove,false);layer.addEventListener("touchend",this.onTouchEnd,false);layer.addEventListener("touchcancel",this.onTouchCancel,false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==="click"){rmv.call(layer,type,callback.hijacked||callback,capture)}else{rmv.call(layer,type,callback,capture)}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==="click"){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event)}}),capture)}else{adv.call(layer,type,callback,capture)}}}if(typeof layer.onclick==="function"){oldOnClick=layer.onclick;layer.addEventListener("click",function(event){oldOnClick(event)},false);layer.onclick=null}}var deviceIsWindowsPhone=navigator.userAgent.indexOf("Windows Phone")>=0;var deviceIsAndroid=navigator.userAgent.indexOf("Android")>0&&!deviceIsWindowsPhone;var deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent)&&!deviceIsWindowsPhone;var deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent);var deviceIsIOSWithBadTarget=deviceIsIOS&&/OS [6-7]_\d/.test(navigator.userAgent);var deviceIsBlackBerry10=navigator.userAgent.indexOf("BB10")>0;FastClick.prototype.needsClick=function(target){switch(target.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(target.disabled){return true}break;case"input":if(deviceIsIOS&&target.type==="file"||target.disabled){return true}break;case"label":case"iframe":case"video":return true}return/\bneedsclick\b/.test(target.className)};FastClick.prototype.needsFocus=function(target){switch(target.nodeName.toLowerCase()){case"textarea":return true;case"select":return!deviceIsAndroid;case"input":switch(target.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return!target.disabled&&!target.readOnly;default:return/\bneedsfocus\b/.test(target.className)}};FastClick.prototype.sendClick=function(targetElement,event){var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur()}touch=event.changedTouches[0];clickEvent=document.createEvent("MouseEvents");clickEvent.initMouseEvent(this.determineEventType(targetElement),true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent)};FastClick.prototype.determineEventType=function(targetElement){if(deviceIsAndroid&&targetElement.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};FastClick.prototype.focus=function(targetElement){var length;if(deviceIsIOS&&targetElement.setSelectionRange&&targetElement.type.indexOf("date")!==0&&targetElement.type!=="time"&&targetElement.type!=="month"){length=targetElement.value.length;targetElement.setSelectionRange(length,length)}else{targetElement.focus()}};FastClick.prototype.updateScrollParent=function(targetElement){var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode}return eventTarget};FastClick.prototype.onTouchStart=function(event){var targetElement,touch,selection;if(event.targetTouches.length>1){return true}targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true}if(!deviceIsIOS4){if(touch.identifier&&touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false}this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement)}}this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if(event.timeStamp-this.lastClickTime<this.tapDelay){event.preventDefault()}return true};FastClick.prototype.touchHasMoved=function(event){var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true}return false};FastClick.prototype.onTouchMove=function(event){if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null}return true};FastClick.prototype.findControl=function(labelElement){if(labelElement.control!==undefined){return labelElement.control}if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor)}return labelElement.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};FastClick.prototype.onTouchEnd=function(event){var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick){return true}if(event.timeStamp-this.lastClickTime<this.tapDelay){this.cancelNextClick=true;return true}if(event.timeStamp-this.trackingClickStart>this.tapTimeout){return true}this.cancelNextClick=false;this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent}targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==="label"){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(deviceIsAndroid){return false}targetElement=forElement}}else if(this.needsFocus(targetElement)){if(event.timeStamp-trackingClickStart>100||deviceIsIOS&&window.top!==window&&targetTagName==="input"){this.targetElement=null;return false}this.focus(targetElement);this.sendClick(targetElement,event);if(!deviceIsIOS||targetTagName!=="select"){this.targetElement=null;event.preventDefault()}return false}if(deviceIsIOS&&!deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true}}if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event)}return false};FastClick.prototype.onTouchCancel=function(){this.trackingClick=false;this.targetElement=null};FastClick.prototype.onMouse=function(event){if(!this.targetElement){return true}if(event.forwardedTouchEvent){return true}if(!event.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation()}else{event.propagationStopped=true}event.stopPropagation();event.preventDefault();return false}return true};FastClick.prototype.onClick=function(event){var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(event.target.type==="submit"&&event.detail===0){return true}permitted=this.onMouse(event);if(!permitted){this.targetElement=null}return permitted};FastClick.prototype.destroy=function(){var layer=this.layer;if(deviceIsAndroid){layer.removeEventListener("mouseover",this.onMouse,true);layer.removeEventListener("mousedown",this.onMouse,true);layer.removeEventListener("mouseup",this.onMouse,true)}layer.removeEventListener("click",this.onClick,true);layer.removeEventListener("touchstart",this.onTouchStart,false);layer.removeEventListener("touchmove",this.onTouchMove,false);layer.removeEventListener("touchend",this.onTouchEnd,false);layer.removeEventListener("touchcancel",this.onTouchCancel,false)};FastClick.notNeeded=function(layer){var metaViewport;var chromeVersion;var blackberryVersion;var firefoxVersion;if(typeof window.ontouchstart==="undefined"){return true}chromeVersion=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(chromeVersion){if(deviceIsAndroid){metaViewport=document.querySelector("meta[name=viewport]");if(metaViewport){if(metaViewport.content.indexOf("user-scalable=no")!==-1){return true}if(chromeVersion>31&&document.documentElement.scrollWidth<=window.outerWidth){return true}}}else{return true}}if(deviceIsBlackBerry10){blackberryVersion=navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);if(blackberryVersion[1]>=10&&blackberryVersion[2]>=3){metaViewport=document.querySelector("meta[name=viewport]");if(metaViewport){if(metaViewport.content.indexOf("user-scalable=no")!==-1){return true}if(document.documentElement.scrollWidth<=window.outerWidth){return true}}}}if(layer.style.msTouchAction==="none"||layer.style.touchAction==="manipulation"){return true}firefoxVersion=+(/Firefox\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(firefoxVersion>=27){metaViewport=document.querySelector("meta[name=viewport]");if(metaViewport&&(metaViewport.content.indexOf("user-scalable=no")!==-1||document.documentElement.scrollWidth<=window.outerWidth)){return true}}if(layer.style.touchAction==="none"||layer.style.touchAction==="manipulation"){return true}return false};FastClick.attach=function(layer,options){return new FastClick(layer,options)};if(typeof define==="function"&&typeof define.amd==="object"&&define.amd){define(function(){return FastClick})}else if(typeof module!=="undefined"&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick}else{window.FastClick=FastClick}})()},{}]},{},[3]);