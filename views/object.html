<article id='object'>

  <!-- Content -->
  <div class='object-content'>

	  <h3 class='title' ng-bind-template="{{wp.title}}"></h3>

	  <div class='object-tombstone' ng-class='{extended: showExtendedTombstone}'>
		  <h5 class='meta1'>{{wp.meta1}}</h5>
		  <h6 class='meta2'>{{wp.meta2}}</h6>
	    <h6 class='meta3' ng-bind-html="wp.meta3"></h6>
	  </div>

    <a class='meta-toggle' ng-class='{open: showExtendedTombstone}' ng-click='toggleExtendedTombstone()'></a>

    <nav class='object-nav clearfix'>
      <a ng-class="{selected: activeSection == 'about'}" ng-click="toggleView('about')">About</a>
      <a ng-class="{selected: activeSection == 'annotations', disabled: !viewEnabled('annotations', true)}" ng-click="toggleView('annotations')">Details</a>
      <a ng-class="{selected: activeSection == 'more', disabled: !viewEnabled('more', true)}" ng-click="toggleView('more')">More</a>
    </nav>

    <div class='object-stories'>

    	<!-- Where is scope.meta defined? Is this vestigial? --> 
	    <p class='object-about' ng-if="activeSection == 'about'" ng-bind-html="wp.trustedDescription || meta.trustedDescription"></p>

	    <ol class='object-details' ng-class="{active: activeSection == 'annotations'}" ng-if="activeSection == 'annotations'">
        <li ng-repeat="note in allNotes" ng-class="{active: note.active}" class="annotation">

          <h3 class='annotation-title' ng-click="activateNote(note, note.view)"><span class='annotation-index'>{{note.index}}</span>{{note.title || 'Annotation'}}</h3>
          <div class='annotation-content' ng-bind-html="note.trustedDescription"></div>

          <div class='annotation-attachments' ng-if="note.attachments.length">

            <p>Tap to expand</p>
            <div class='attachment-thumb' ng-repeat="attachment in note.attachments" ng-click="toggleAttachment(attachment, false)" ng-class="{active:attachment == currentAttachment}" style='background-image:url("{{attachment.thumbnail}}")'></div>

          </div>
	      </li>
	    </ol>

	    <div class='object-more' ng-if="activeSection == 'more'" ng-class="{active: activeSection == 'more'}">
	      <h5 class='more-title' ng-show="relatedStories">Interactive Features</h5>
	      <ol id="relatedStories">
	        <li ng-repeat="story in relatedStories">
	        <a ng-href="#/stories/{{story.id}}" ng-bind="story.title"></a>
	        </li>
	      </ol>
	    </div>

	  </div>

  </div>

  <!-- Zoomer -->
  <flatmap class='object-zoomer' image="{{id}}">
  	<div ng-repeat="view in notes" ng-class="{active: activeSection == 'views'}">
      <note ng-repeat="note in view.annotations" ng-class="{active: note.active}"></note>
    </div>
  </flatmap>

  <a class='home-link' href='#'></a>

	<!-- Fullscreen attachments -->
  <div class='attachment-big' ng-repeat='attachment in allAttachments' ng-class="{active: attachment == currentAttachment}">
    <flatmap class='attachment-zoomer' image="{{attachment.image_id}}"></flatmap>
    <a class="back icon-back icon" ng-click="toggleAttachment(attachment, true, $event)">
      Back
    </a>
    <a class="credits icon-info-circled icon" ng-if="attachment.meta" ng-click="toggleAttachmentCredits(attachment)" ng-hide="showAttachmentCredits">
      Info
    </a>
    <aside ng-show="showAttachmentCredits" ng-if="attachment.meta" ng-click="toggleAttachmentCredits(attachment)">
      <p ng-bind-html="attachment.meta"></p>
    </aside>
  </div>

</article>