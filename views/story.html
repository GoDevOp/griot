<article id="story">

  <h1 class='story-title' ng-bind="story.title"></h1>

  <a class='story-home-link' href='#'></a>

  <div class='pages-wrap' ng-style="{left: '-' + (activePage * 100) + '%'}">
    
    <section ng-repeat="page in story.pages" class="page page-{{page.type}}" ng-class="{tall: imageAspectRatio <= 1 && page.type == 'image', wide: imageAspectRatio > 1, full: !page.storyCaptionOpen, contentMinimized:page.contentMinimized}">

      <div class='story-illustration' ng-class="{collapsed: page.storyCaptionOpen }">

        <!-- Comparison -->
        <div class='story-comparison' ng-if="page.type == 'comparison'">
          <flatmap image={{page.image}} class='flatmap-a'></flatmap>
          <flatmap image={{page.imageB}} class='flatmap-b'></flatmap>
        </div>

        <!-- Image -->
        <div class='story-image' ng-if="page.type == 'image'" ng-class="{tall: imageAspectRatio <= 1, wide: imageAspectRatio > 1, full: !page.storyCaptionOpen}">
          <flatmap image={{page.image}}></flatmap>
        </div>

        <!-- Video -->
        <div class='story-video vcenter' ng-if="page.type == 'video'">
          <video controls ng-src="{{page.trustedVideo}}" ng-poster="{{page.poster}}" width="800" height="800" on-play ng-class="{playing: page.playingNow}" x-webkit-airplay="deny"></video>
        </div>

        <!-- Iframe -->
        <iframe class='story-iframe' ng-src="{{page.iframe}}" ng-if="page.iframe"></iframe>

      </div>

      <div class='story-content' ng-if="page.text" ng-class="{expanded: page.storyCaptionOpen }">

        <div ng-bind-html="page.trustedText" class='caption'></div>
        <aside ng-if="page.meta" ng-bind-html="page.meta"></aside>
        <aside ng-if="page.metaB" ng-bind-html="page.metaB"></aside>

      </div>
      
      <menu class='story-menu'>
        <a class='toggle-content' ng-if="page.text" ng-click="page.toggleMinimizeContent()"></a>
      </menu>

    </section>

  </div>

  <!-- Navigation -->
  <a class='story-return nav-button-left' ng-click="backToObject()" ng-show="activePage == 0"></a>
  <a class='story-prev-page' ng-click="updateActivePage(activePage - 1)" ng-hide="activePage == 0"></a>
  <a class='story-return nav-button-right' ng-click="backToObject()" ng-show="activePage == (story.pages.length - 1) && story.pages.length > 1"></a>
  <a class='story-next-page' ng-click="updateActivePage(activePage + 1)" ng-hide="activePage == (story.pages.length - 1)"></a>

</article>